/*! wee-promise - 0.2.0 - Bernard McManus - gea4426 - 2014-11-26 */
!function(a){var b=this;"object"==typeof exports?module.exports=a:b.Promise=b.Promise||a}(function(a){function b(a){var b=this;j([t,u,s],function(a){b[a]=[]}),g(function(){h(b,function(){a(c(b,t),c(b,u))}),b[x]=!0})}function c(a,b){function c(d){g(a[x]?function(){a[m]||a[w](b,d)[w](s,d)}:function(){c(d)})}return c}function d(a,b,c,d,g){return function(){a=a.map(function(b,c){return f(b[n])?b[n]:a[c]});var h=e(a,1),j=e(a,-1);if(i(h)===d){var k=h.map(function(a){return a[n][0]});b(g?k[0]:k)}else i(j)>0&&c(j[0][n][0])}}function e(a,b){return a.filter(function(a){return a[m]===b})}function f(a){return a instanceof b}function g(b){a(b,1)}function h(a,b){try{return b()}catch(c){return a[w](u,c)}}function i(a){return a.length}function j(a,b){a.forEach(b)}var k,l=(require("util"),"prototype"),m="state",n="args",o="always",p="then",q="catch",r="pass",s="_"+o,t="_"+p,u="_"+q,v="_add",w="_exec",x="_ready",y={};return y[t]=1,y[u]=-1,b[l][v]=function(a,b){var c=this;return b&&c[a].push(b),c},b[l][w]=function(a,b){var c,d,e=this,g=e[a],j=i(g),l=0;return h(e,function(){for(;j>l;){if(c=y[a]?g.shift():g[l],d=c.apply(k,[b]),f(d))return g.unshift(c),e[r](d);if(a==u)break;b=y[a]?d:b,l++}return e[n]=e[m]?e[n]:[b],e[m]=y[a]||e[m],e})},b[l][o]=function(a){return this[v](s,a)},b[l][p]=function(a,b){return this[v](t,a)[q](b)},b[l][q]=function(a){return this[v](u,a)},b[l][r]=function(a){var b=this;return j([t,u,s],function(c){a[c]=b[c]}),b[n]=a,a},b.all=function(a){return new b(function(b,c){j(a,function(e){e[o](d(a,b,c,i(a)))})})},b.race=function(a){return new b(function(b,c){j(a,function(e){e[o](d(a,b,c,1,!0))})})},b}(setTimeout));