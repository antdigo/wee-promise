/*! wee-promise - 1.0.0 - Bernard McManus - 022c415 - 2015-12-03 */
!function(a,b){"use strict";function c(){var a=[],c=0,d=0,e={push:function(b,d){d&&(a[c]={type:b,func:d},c++)},pull:function(){var e=a[d];return a[d]=b,d++,d==c&&(a.length=d=c=0),e},next:function(a){for(var b,f=d;c>f;){if(b=e.pull(),b&&b.type==a)return b.func;f++}}};return e}function d(a){var b=this;b._queue=c(),b._inprog=!1,b.resolve=e(b,k),b.reject=e(b,l),h(function(){if(a)try{a(b.resolve,b.reject)}catch(c){b.reject(c)}})}function e(a,b){return function(c){return a._state||a._exec(b,c),a}}function f(a){return!(!a||!a.then)}function g(a,b){return b.then(function(b){a._exec(k,b)}).fail(function(b){a._exec(l,b)}),a}var h=function(){var c=""+b;return typeof setImmediate!=c?setImmediate:typeof MessageChannel!=c?function(a){var b=new MessageChannel;b.port1.onmessage=function(){a()},b.port2.postMessage(0)}:a}(),i=1,j=2,k="then",l="fail";d.prototype._add=function(a,b){var c=this,d=c._state,e=a==k&&d==i||a==l&&d==j;return c._queue.push(a,b),e&&!c._inprog?c._exec(a,c.result):c},d.prototype._exec=function(a,c){var d,e=this,h=e._queue;e._inprog=!0;try{switch(a){case k:for(;d=h.next(a);)if(c=d.call(b,c),f(c))return g(e,c);e._state=i;break;case l:if(d=h.next(a))return c=d.call(b,c),f(c)?g(e,c):e._exec(k,c);e._state=j}}catch(m){return e._exec(l,m)}return e.result=c,e._inprog=!1,e},d.prototype.then=function(a,b){return this._add(k,a).fail(b)},d.prototype.fail=function(a){return this._add(l,a)},d.prototype["catch"]=d.prototype.fail,d.resolve=function(a){return(new d).resolve(a)},d.reject=function(a){return(new d).reject(a)},d.all=function(a){return new d(function(b,c){function d(a,c){e[c]=a,g++,g==h&&b(e)}var e=[],g=0,h=a.length;a.forEach(function(a,b){f(a)?a.then(function(a){d(a,b)}).fail(function(a){c(a)}):d(a,b)})})},d.race=function(a){return new d(function(b,c){a.forEach(function(a){f(a)?a.then(b).fail(c):b(a)})})},"object"==typeof exports?module.exports=d:self.WeePromise=d}(setTimeout);