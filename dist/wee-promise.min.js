/*! wee-promise - 1.0.0 - Bernard McManus - 7c4163c - 2015-12-04 */
!function(a,b,c){"use strict";function d(){var a=[],b=0,d=0,e={push:function(c,d){a[b]={type:c,func:d},b++},pull:function(){var e=a[d];return a[d]=c,d++,d==b&&(a.length=d=b=0),e},next:function(a){for(var c,f=d;b>f;){if(c=e.pull(),c&&c.type==a)return c.func;f++}}};return e}function e(a){var b=this;if(b._queue=d(),b._inprog=!1,b.resolve=f(b,m),b.reject=f(b,n),a)try{a(b.resolve,b.reject)}catch(c){b.reject(c)}}function f(a,b){return function(c){return j(function(){a._state||a._exec(b,c)}),a}}function g(a){return"function"==typeof a}function h(a){return!(!a||!a.then)}function i(a,b){return b.then(function(b){a._exec(m,b)}).fail(function(b){a._exec(n,b)}),a}var j=function(){var b=""+c;return typeof setImmediate!=b?setImmediate:typeof MessageChannel!=b?function(a){var b=new MessageChannel;b.port1.onmessage=function(){a()},b.port2.postMessage(0)}:a}(),k=1,l=2,m="then",n="fail";e.prototype._add=function(a,b){var c=this;return g(b)&&c._queue.push(a,b),c},e.prototype._exec=function(a,d){var e,f=this,g=f._queue;f._inprog=!0;try{switch(a){case m:for(;e=g.next(a);){if(d=e.call(c,d),d==f)throw new b("A promise cannot be resolved with itself.");if(h(d))return i(f,d)}f._state=k;break;case n:if(e=g.next(a))return d=e.call(c,d),h(d)?i(f,d):f._exec(m,d);f._state=l}}catch(j){return f._exec(n,j)}return f.result=d,f._inprog=!1,f},e.prototype.then=function(a,b){return this._add(m,a).fail(b)},e.prototype.fail=function(a){return this._add(n,a)},e.prototype["catch"]=e.prototype.fail,e.resolve=function(a){return(new e).resolve(a)},e.reject=function(a){return(new e).reject(a)},e.all=function(a){return new e(function(b,c){function d(a,c){e[c]=a,f++,f==g&&b(e)}var e=[],f=0,g=a.length;a.forEach(function(a,b){h(a)?a.then(function(a){d(a,b)}).fail(function(a){c(a)}):d(a,b)})})},e.race=function(a){return new e(function(b,c){a.forEach(function(a){h(a)?a.then(b).fail(c):b(a)})})},"object"==typeof exports?module.exports=e:self.WeePromise=e}(setTimeout,TypeError);