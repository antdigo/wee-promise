/*! wee-promise - 0.3.0 - Bernard McManus - b6d205d - 2015-11-30 */
!function(a){"object"==typeof exports?module.exports=a:this.WeePromise=a}(function(a,b){"use strict";function c(b){var c=this;k([y,z,x],function(a){c[a]=[]}),c[m]=d(c,y),c[n]=d(c,z),a(function(){c[E]=f(c),b&&i(c,function(){b(c[m],c[n])}),c[C]=!0})}function d(b,c){function d(e){b[C]?b[v]||b[B](c,e)[B](x,e):a(function(){d(e)})}return d}function e(a,b,c,d,e){return function(){a=a.map(function(a,b){return h(a[w])?a[w]:a});var f=g(a,s),i=g(a,t);if(j(f)==d){var k=f.map(function(a){return a[w][0]});b(e?k[0]:k)}else j(i)>0&&c(i[0][w][0])}}function f(a){return j(a[z])>0}function g(a,b){return a.filter(function(a){return a[v]===b})}function h(a){return!!(a&&a[p]&&a[q])}function i(a,b){try{return b()}catch(c){return a[B](z,c)}}function j(a){return a.length}function k(a,b){a.forEach(b)}var l="prototype",m="resolve",n="reject",o="always",p="then",q="catch",r=b,s=1,t=2,u="_pass",v="_state",w="_result",x="_"+o,y="_"+p,z="_"+q,A="_add",B="_exec",C="_ready",D="_child",E="_handled",F=E+"Self",G={};return G[y]=s,G[z]=t,c[l][A]=function(a,b){var c=this;return b&&c[a].push(b),c},c[l][B]=function(a,c){var c,d=this,e=d[a],f=j(e),g=G[a]||r,k=0;return i(d,function(){for(;f>k;){if(g&&d[v]===g&&d[D]&&d[E]&&(e=!d[F]||d[C]?[]:e.slice(-1),k=f-1,!j(e)))return d;if(c=(g?e.shift():e[k]).apply(b,[c]),h(c))return d[u](c);if(a==z){if(d[E])return g=G[y],d[D]&&(d[v]=g,d[w]=[c]),d[B](y,c)[B](x,c);break}k++}return d[w]=d[v]?d[w]:[c],d[v]=d[v]||g,d})},c[l][o]=function(a){return this[A](x,a)},c[l][p]=function(a,b){return this[A](y,a)[q](b)},c[l][q]=function(a){return this[A](z,a)},c[l][u]=function(a){var b=this;return a[F]=f(a),a[D]=!0,k([y,z,x],function(c){a[c]=a[F]?a[c].concat(b[c]):b[c]}),b[w]=a,a},c[m]=function(a){var b=new c;return b[m](a),b},c[n]=function(a){var b=new c;return b[n](a),b},c.all=function(a){return new c(function(b,c){k(a,function(d){d[o](e(a,b,c,j(a)))})})},c.race=function(a){return new c(function(b,c){k(a,function(d){d[o](e(a,b,c,1,!0))})})},c}(setTimeout));