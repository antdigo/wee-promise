/*! wee-promise - 1.0.0 - Bernard McManus - 799db9e - 2015-12-08 */
!function(a,b,c,d){"use strict";function e(){var a=this;a.q=[],a.i=0,a.len=0}function f(a){var b=this,c=k(function(a,c){a(b,c)});if(b._stack=new e,b.resolve=function(a){return c(g,a),b},b.reject=function(a){return c(h,a),b},a)try{a(b.resolve,b.reject)}catch(d){b.reject(d)}}function g(a,b){b===a?h(a,new c("A promise cannot be resolved with itself.")):j(b,function(b,c){i(a,b,c)})}function h(a,b){i(a,p,b)}function i(a,b,c){a._state!=b&&(a.value=c,a._state=b,a._flush())}function j(a,b){if(a instanceof f&&a._state)b(a._state,a.value);else if(l(a)||m(a)){var c,e=k(function(a,b){a.apply(d,b)});try{c=a.then,m(c)?c.call(a,function(a){e(j,[a,b])},function(a){e(b,[p,a])}):e(b,[o,a])}catch(g){e(b,[p,g])}}else b(o,a)}function k(a){var b;return function(){b||(a.apply(d,arguments),b=!0)}}function l(a){return a&&"object"==typeof a}function m(a){return"function"==typeof a}var n=function(){var a=""+d;return typeof setImmediate!=a?setImmediate:typeof MessageChannel!=a?function(a){var b=new MessageChannel;b.port1.onmessage=function(){a()},b.port2.postMessage(0)}:b}();e.prototype.put=function(a){var b=this;b.q[b.len]=a,b.len++},e.prototype.get=function(){var a=this,b=a.q[a.i];return a.i++,a.i==a.len&&(a.q.length=a.i=a.len=0),b};var o=1,p=2;f.prototype={constructor:f,onresolved:function(a){return a},onrejected:function(a){throw a},_flush:function(){var a=this,b=a._state;b&&n(function(){!function c(){var d=a._stack.get();if(d){var e=b==o?d.onresolved:d.onrejected;try{g(d,e(a.value))}catch(f){h(d,f)}c()}}()})},then:function(a,b){var c=this,d=new f;return m(a)&&(d.onresolved=a),m(b)&&(d.onrejected=b),c._stack.put(d),c._flush(),d},"catch":function(a){return this.then(d,a)}},f.resolve=function(a){return(new f).resolve(a)},f.reject=function(a){return(new f).reject(a)},f.all=function(a){var b=new f,c=[],d=0,e=a.length;return a.forEach(function(a,f){j(a,function(a,g){d++,c[f]=g,a==p?b.reject(g):d==e&&b.resolve(c)})}),b},f.race=function(a){var b=new f;return a.forEach(function(a){j(a,function(a,c){i(b,a,c)})}),b},"object"==typeof exports?module.exports=f:self.WeePromise=f}(Object,setTimeout,TypeError);